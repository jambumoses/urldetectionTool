{% extends '../layout.html' %}

<!-- context -->
{% block content %}

<section class="report-page">
    <section class="filter">
        
            <h1>Report</h1>
        
        
        <form method="post">

            <span class="searchInput">
                <input type="search" name="search" placeholder="Search" id="" />
                <button type="submit" class="icon">
                    <i style="color: var(--white);" class="fa fa-search"></i>
                </button>
            </span>
        </form>
    </section>

    <section class="report-tables">
        <table border="0">
            <thead>
                <tr class="header">
                    <th>Host</th>
                    <th>Scanned URL</th>
                    <th>Prediction</th>
                    <th>Risk Level</th>
                    <th>Results</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody>
                {% for report in allreports %}
                <tr onclick="">
                    <script>
                        setTimeout(() => {
                            progressBar('progress-{{report.id}}',
                            {% if report.malicious < 10 and report.suspicious < 10 and report.harmless > 50 %}
                                {{report.harmless}}
                            {% elif report.malicious < 30 or report.suspicious > 50 and report.harmless < 50 %}
                                {{report.suspicious}}
                            {% elif report.malicious > 30 or report.suspicious > 30 and report.harmless < 50 %}
                                {{report.malicious}}
                            {% else %}
                                10
                            {% endif %}
                            ) //end of function
                        }, 1000);
                    </script>

                    <td> {{report.id}}</td>
                    <td title="{{ report.url }}"> <a href="/result/{{report.id}}"> <script> document.write("{{ report.url }}".slice(0,25)+" ..."); </script> </a> </td>
                    <td>
                        {% if report.malicious < 10 and report.suspicious < 10 and report.harmless > 50 %}
                            Legitemate
                        {% elif report.malicious < 30 or report.suspicious > 50 and report.harmless < 50 %}
                            Warning
                        {% elif report.malicious > 30 or report.suspicious > 30 and report.harmless < 50 %}
                            Dangerous
                        {% else %}
                            Undetected
                        {% endif %}
                    </td>
                    <td>
                        <progress style="cursor: pointer;" class="
                        {% if report.malicious < 10 and report.suspicious < 10 and report.harmless > 50 %}
                            progress-secure
                        {% elif report.malicious < 30 or report.suspicious > 50 and report.harmless < 50 %}
                            progress-warning
                        {% elif report.malicious > 30 or report.suspicious > 30 and report.harmless < 50 %}
                            progress-danger
                        {% else %}
                            Undetected
                        {% endif %}

                        "
                        title=""
                        id="progress-{{report.id}}" 
                        value="0" max="100" > 32% </progress>
                    </td>
                    <td>{{ report.category }}</td>
                    <td>{{ report.created_at }}</td>
                </tr>

                {% endfor %}
              
            </tbody>
            <tfoot></tfoot>
        </table>
    </section>
</section>

<script>
    function progressBar(id,value){
        //alert(id + " " + value);
        document.getElementById(id).value = (100 - value);
        document.getElementById(id).title = (100 - value)+"%";
    }
</script>

<!-- end of context -->
{% endblock content %}